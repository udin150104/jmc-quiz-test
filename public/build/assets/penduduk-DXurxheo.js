function y(){const u=new bootstrap.Modal(document.getElementById("form-modal")),h=new bootstrap.Modal(document.getElementById("delete-modal"));$(document).on("click","#btn-add",function(){$("#title-form").html("Tambah Data"),u.show(),flatpickr('input[name="tanggal_lahir"]',{defaultDate:new Date,dateFormat:"d/m/Y",locale:"id",allowInput:!0,static:!0,appendTo:document.body,onOpen:function(a,t,e){setTimeout(()=>{e.calendarContainer.classList.add("open")},10)},yearSelectorType:"dropdown"})}),$(document).on("click",".btn-edit",function(){const a=$(this).data("id");$.get(`/application/penduduk/${a}`,function(t){u.show(),$("#title-form").html("Ubah Data"),$('input[name="nik"]').val(t.nik),$('input[name="nama"]').val(t.nama);const e=new Date(t.tanggal_lahir);flatpickr('input[name="tanggal_lahir"]',{defaultDate:e,dateFormat:"d/m/Y",locale:"id",allowInput:!0,static:!0,appendTo:document.body,onOpen:function(c,n,i){setTimeout(()=>{i.calendarContainer.classList.add("open")},10)},yearSelectorType:"dropdown"}),$('input[name="jenis_kelamin"][value="'+t.jenis_kelamin+'"]').prop("checked",!0),$('select[name="provinsi"]').val(t.provinsi_id).trigger("change"),f(t.provinsi_id,function(){$('select[name="kabupaten"]').val(t.kabupaten_id)}),$('textarea[name="alamat"]').val(t.alamat),$("#form-data").attr("data-id",a)})});let p;$(document).on("click",".btn-delete",function(){p=$(this).data("id"),h.show()}),$(document).on("click",".delete-action",function(){$.ajax({url:`/application/penduduk/${p}`,type:"DELETE",success:function(a){let t=$("#pagination .page-item.active .page-link").data("page")||1;r(t),$("#btn-batal-delete").trigger("click")},error:function(a){console.error(a.responseText)}})}),$(document).on("click","#submit-action",function(){$(".help").html("");const a=$("#form-data"),t=a.serialize(),e=a.attr("data-id"),c=e?`/application/penduduk/${e}`:"/application/penduduk",n=e?"PUT":"POST";$.ajax({url:c,method:n,data:t,success:function(i){let o=$("#pagination .page-item.active .page-link").data("page")||1;r(o),$("#btn-batal").trigger("click")},error:function(i){if(i.status===422){const o=i.responseJSON.errors;for(const d in o)$(`#${d}-help`).html(o[d][0])}}})}),$(document).on("click","#btn-batal",function(){$(".help").html(""),$("#form-data").get(0).reset(),$("#form-data").removeAttr("data-id",""),u.hide()}),$(document).on("click","#btn-batal-delete",function(){p=null,h.hide()});function b(a,t=5){const e=a.current_page,c=a.last_page;let n="";const i=(o,d=null,l=!1,s=!1)=>`
      <li class="page-item ${l?"active":""} ${s?"disabled":""} rounded-0">
        <a class="page-link  rounded-0" href="#" data-page="${s?"":o}">
          ${d??o}
        </a>
      </li>`;if(n+=i(e-1,'<i class="bi bi-caret-left"></i>',!1,e===1),c<=t+2)for(let o=1;o<=c;o++)n+=i(o,null,o===e);else{n+=i(1,null,e===1);let o=Math.max(2,e-Math.floor(t/2)),d=Math.min(c-1,e+Math.floor(t/2));o>2&&(n+='<li class="page-item disabled"><span class="page-link">…</span></li>');for(let l=o;l<=d;l++)n+=i(l,null,l===e);d<c-1&&(n+='<li class="page-item disabled"><span class="page-link">…</span></li>'),n+=i(c,null,e===c)}n+=i(e+1,'<i class="bi bi-caret-right"></i>',!1,e===c),$("#pagination").html(n)}$(document).on("click","#pagination .page-link",function(a){a.preventDefault();const t=parseInt($(this).data("page"));isNaN(t)||r(t)});function r(a=1){const t=$("#search").val(),e=$("#filter-provinsi").val(),c=$("#filter-kabupaten").val();$.get("/application/penduduk/api/data",{page:a,search:t,provinsi:e,kabupaten:c},function(n){let i="";const o=new Date,d=[];n.data.length>0?n.data.forEach(l=>{const s=l.created_at?l.created_at.replace(" ","T"):null;let m=!1;if(s){const k=new Date(s);m=o-k<=60*800}const g=`row-${l.id}`;m&&d.push(g),i+=`
          <tr id="${g}" class="${m?"table-info":""}">
            <td>${l.nama}</td>
            <td class="text-center">${l.umur} <small class="text-muted">tahun</small></td>
            <td>${l.alamat}</td>
            <td class="text-center">
              <button type="button" class="btn btn-sm btn-secondary rounded-0 me-1 btn-edit" data-id="${l.id}">Ubah</button>
              <button type="button" class="btn btn-sm btn-danger rounded-0 btn-delete"  data-id="${l.id}">Hapus</button>
            </td>
          </tr>`}):i+='<tr><td colspan="4" class="text-muted">Belum Ada Data</td></tr>',$("#table-list tbody").html(i),b(n),d.forEach(l=>{setTimeout(()=>{$(`#${l}`).removeClass("table-info")},1e5)})})}r(1),$("#search").on("keyup",function(a){a.key==="Enter"&&r(1)}),$("#filter-provinsi").on("change",function(a){const t=$(this).val();$("#filter-kabupaten").html(""),f(t,"#filter-kabupaten"),r(1)}),$("#filter-kabupaten").on("change",function(a){r(1)});function f(a,t="#kabupaten",e=null){$.get("/application/api/get-kabupaten-by-provinsi",{provinsi:a},function(c){let n='<option value="">Pilih Kabupaten</option>';c.forEach(i=>{n+=`<option value="${i.id}">${i.nama}</option>`}),$(t).html(n),typeof e=="function"&&e()})}$("#provinsi").on("change",function(){const a=$(this).val();$("#kabupaten").html(""),f(a)}),$("#btn-reset-filter").on("click",function(){$("#filter-provinsi, #filter-kabupaten").val(""),$("#search").val(""),$("#search").trigger(jQuery.Event("keyup",{key:"Enter",keyCode:13,which:13}))})}export{y as init};
